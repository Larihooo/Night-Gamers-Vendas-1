<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Night Gamers | Loja</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <div style="font-weight:bold; font-size:1.2rem">Night Gamers üéÆ</div>
        <div id="nav-links"></div>
    </nav>

    <div class="container">
        <h2>Cat√°logo</h2>
        <input type="text" id="search" placeholder="üîç Buscar produto..." onkeyup="render()">
        <div id="grid" class="product-grid">Carregando produtos...</div>
    </div>

    <script type="module">
        import { db, auth, ADMIN_EMAIL } from './firebase.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        let produtos = [];

        onAuthStateChanged(auth, (user) => {
            const nav = document.getElementById('nav-links');
            if(user) {
                let menu = `<a href="perfil.html">Conta</a>`;
                if(user.email === ADMIN_EMAIL) menu += `<a href="admin.html" style="color:var(--accent)">Admin</a>`;
                nav.innerHTML = menu;
            } else {
                nav.innerHTML = `<a href="login.html">Entrar</a>`;
            }
        });

        const q = query(collection(db, "produtos"), orderBy("criadoEm", "desc"));
        onSnapshot(q, (snap) => {
            produtos = snap.docs.map(d => ({id: d.id, ...d.data()}));
            window.render();
        });

        window.render = () => {
            const busca = document.getElementById('search').value.toLowerCase();
            const grid = document.getElementById('grid');
            grid.innerHTML = "";
            
            produtos.filter(p => p.nome.toLowerCase().includes(busca)).forEach(p => {
                // Se n√£o tiver imagem salva (produtos antigos), usa placeholder
                const img = p.imagem || "https://via.placeholder.com/300x300?text=Sem+Foto";
                
                grid.innerHTML += `
                <div class="product-card" onclick="window.location.href='detalhes.html?id=${p.id}'">
                    <img src="${img}" class="card-img" alt="${p.nome}">
                    <div class="card-info">
                        <h3>${p.nome}</h3>
                        <p style="color:var(--accent); font-weight:bold; font-size:1.1rem">R$ ${p.preco}</p>
                        <small style="color:#aaa">${p.estoque > 0 ? 'Dispon√≠vel' : '‚ùå Esgotado'}</small>
                    </div>
                </div>`;
            });
        };
    </script>
</body>
</html>