<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Admin - Night Gamers</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <h3>Novo Produto</h3>
            <input type="text" id="nome" placeholder="Nome">
            <input type="text" id="preco" placeholder="PreÃ§o (Ex: 50.00)">
            <input type="text" id="img" placeholder="URL da Imagem">
            <textarea id="entrega" placeholder="Link/Chave de entrega"></textarea>
            <button id="btn-add">Salvar Produto</button>
        </div>
        <div id="lista-admin"></div>
    </div>

    <script type="module">
        import { db } from './firebase.js';
        import { collection, addDoc, query, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        document.getElementById('btn-add').onclick = async () => {
            const p = {
                nome: document.getElementById('nome').value,
                preco: document.getElementById('preco').value,
                imagem: document.getElementById('img').value,
                entrega: document.getElementById('entrega').value,
                criadoEm: new Date()
            };
            await addDoc(collection(db, "produtos"), p);
            location.reload();
        };

        onSnapshot(query(collection(db, "produtos")), (snap) => {
            const lista = document.getElementById('lista-admin');
            lista.innerHTML = "";
            snap.forEach(d => {
                const item = d.data();
                lista.innerHTML += `<div class="card">${item.nome} <button onclick="window.del('${d.id}')" style="width:auto; background:red">X</button></div>`;
            });
        });

        window.del = async (id) => { if(confirm("Excluir?")) await deleteDoc(doc(db, "produtos", id)); };
    </script>
</body>
</html>