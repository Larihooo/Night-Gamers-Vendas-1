<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes - Night Gamers</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        /* Sidebar (mesmo estilo do index) */
        .sidebar { height: 100vh; width: 250px; position: fixed; z-index: 1000; top: 0; left: 0; background: #0f172a; border-right: 1px solid #334155; display: flex; flex-direction: column; padding-top: 20px; }
        .sidebar h2 { color: #6366f1; text-align: center; margin-bottom: 30px; }
        .sidebar a { padding: 15px 25px; text-decoration: none; color: #94a3b8; display: flex; align-items: center; gap: 10px; }
        .main-content { margin-left: 250px; padding: 20px; }
        #admin-link { display: none; color: #f59e0b !important; }
        
        .detalhes-container { display: flex; gap: 30px; flex-wrap: wrap; margin-top: 20px; }
        .img-grande { width: 100%; max-width: 400px; border-radius: 15px; border: 1px solid #334155; }
        .info-box { flex: 1; min-width: 300px; }
        
        /* Modal PIX */
        #modal-pix { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; }
        .pix-card { background: #1e293b; padding: 30px; border-radius: 20px; text-align: center; border: 2px solid #6366f1; }
        .qr-img { background: white; padding: 10px; border-radius: 10px; width: 200px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Night Gamers</h2>
        <a href="index.html">üè† <span>In√≠cio</span></a>
        <a href="feed.html">üì± <span>Feed Social</span></a>
        <a href="perfil.html">üë§ <span>Minha Conta</span></a>
        <a href="admin.html" id="admin-link">‚öôÔ∏è <span>Painel Admin</span></a>
    </div>

    <div class="main-content">
        <div id="loading">Carregando...</div>
        <div id="produto-detalhe" style="display:none">
            <div class="detalhes-container">
                <img id="p-img" class="img-grande">
                <div class="info-box card">
                    <h1 id="p-nome"></h1>
                    <h2 id="p-preco" style="color:var(--accent)"></h2>
                    <p id="p-desc" style="color:#94a3b8; margin: 20px 0; line-height:1.6"></p>
                    <hr style="border:0; border-top:1px solid #333; margin:20px 0">
                    <div id="wallet_container"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-pix">
        <div class="pix-card">
            <h3>Pague com PIX</h3>
            <div id="qr-code-area"></div>
            <button onclick="copiarPix()">Copiar C√≥digo PIX</button>
            <p id="pix-texto" style="display:none"></p>
            <p style="margin-top:15px; color:var(--primary)">Aguardando pagamento... üîÑ</p>
        </div>
    </div>

    <script type="module">
        import { db, auth, ADMIN_EMAIL } from './firebase.js?v=1';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

        const mp = new MercadoPago('APP_USR-7e780497-69b9-4363-9a79-245f789d2d8d');
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        let dadosProd = null;

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ADMIN_EMAIL) document.getElementById('admin-link').style.display = 'flex';
        });

        async function carregar() {
            const snap = await getDoc(doc(db, "produtos", id));
            if(snap.exists()) {
                dadosProd = snap.data();
                document.getElementById('p-nome').innerText = dadosProd.nome;
                document.getElementById('p-preco').innerText = "R$ " + dadosProd.preco;
                document.getElementById('p-img').src = dadosProd.imagem;
                document.getElementById('p-desc').innerText = dadosProd.descricao || "Sem descri√ß√£o.";
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('produto-detalhe').style.display = 'block';

                mp.bricks().create("wallet", "wallet_container", {
                    initialization: { amount: parseFloat(dadosProd.preco) },
                    callbacks: { onSubmit: (formData) => processarPagamento(formData) }
                });
            }
        }

        // Simula√ß√£o de processamento (Aqui voc√™ conectaria ao seu proxy/backend)
        async function processarPagamento(data) {
            console.log("Iniciando pagamento para:", dadosProd.nome);
            // L√≥gica do Mercado Pago aqui...
        }

        window.copiarPix = () => {
            navigator.clipboard.writeText(document.getElementById('pix-texto').innerText);
            alert("PIX Copiado!");
        };

        carregar();
    </script>
</body>
</html>